
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ•ÿØÿßÿ±Ÿäÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖ - ÿßŸÑÿ•ÿµÿØÿßÿ± 2.0</title>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, get, remove, update, child } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDqwVpiB_jrnWek_Pemns7hI7aUgMQOHas",
            authDomain: "twap-59d3e.firebaseapp.com",
            databaseURL: "https://twap-59d3e-default-rtdb.firebaseio.com",
            projectId: "twap-59d3e",
            storageBucket: "twap-59d3e.firebasestorage.app",
            messagingSenderId: "193674884546",
            appId: "1:193674884546:web:ca5a7aee2fcb4361d6925b"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseRemove = remove;
        window.firebaseUpdate = update;
        window.firebaseChild = child;
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1a365d;
            --secondary: #2563eb;
            --accent: #dc2626;
            --success: #16a34a;
            --warning: #ea580c;
            --info: #0891b2;
            --light: #f8fafc;
            --dark: #0f172a;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.16);
            --shadow-xl: 0 12px 32px rgba(0, 0, 0, 0.2);
        }

        html {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* ========== ANIMATIONS ========== */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        @keyframes rotateBorder {
            0% {
                border-color: var(--secondary);
            }
            50% {
                border-color: var(--success);
            }
            100% {
                border-color: var(--secondary);
            }
        }

        @keyframes expandDown {
            from {
                opacity: 0;
                max-height: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                max-height: 1000px;
                transform: translateY(0);
            }
        }

        @keyframes cardHover {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-8px);
            }
        }

        /* ========== GLOBAL STYLES ========== */
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* ========== HEADER ========== */
        header {
            text-align: center;
            padding: 50px 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: var(--shadow-lg);
            animation: fadeInDown 0.6s ease-out;
        }

        header h1 {
            font-size: 2.8rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            animation: pulse 2s ease-in-out infinite;
        }

        header .subtitle {
            color: #64748b;
            font-size: 1.2rem;
            margin-bottom: 25px;
        }

        /* ========== CONTROLS ========== */
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 30px;
            animation: fadeInUp 0.6s ease-out 0.2s backwards;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.4);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 400px;
            height: 400px;
        }

        .btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: var(--shadow-xl);
        }

        .btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .btn i, .btn span {
            position: relative;
            z-index: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), #3b82f6);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #22c55e);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--accent), #ef4444);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #f97316);
        }

        .btn-sm {
            padding: 10px 16px;
            font-size: 0.9rem;
        }

        /* ========== MAIN LAYOUT ========== */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) backwards;
        }

        .section:nth-child(1) {
            animation-delay: 0.1s;
        }

        .section:nth-child(2) {
            animation-delay: 0.2s;
        }

        .section-title {
            font-size: 1.6rem;
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* ========== AREAS LIST ========== */
        .areas-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .areas-list::-webkit-scrollbar {
            width: 8px;
        }

        .areas-list::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }

        .areas-list::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }

        .areas-list::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        .area-item {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border-right: 5px solid var(--secondary);
            position: relative;
            overflow: hidden;
            animation: slideInLeft 0.5s ease-out backwards;
        }

        .area-item:nth-child(1) { animation-delay: 0.1s; }
        .area-item:nth-child(2) { animation-delay: 0.15s; }
        .area-item:nth-child(3) { animation-delay: 0.2s; }
        .area-item:nth-child(4) { animation-delay: 0.25s; }
        .area-item:nth-child(5) { animation-delay: 0.3s; }

        .area-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1), rgba(124, 58, 237, 0.1));
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .area-item:hover {
            transform: translateX(-10px) translateY(-3px);
            box-shadow: var(--shadow-lg);
            border-right-width: 8px;
        }

        .area-item:hover::before {
            opacity: 1;
        }

        .area-item.selected {
            background: linear-gradient(135deg, var(--secondary), #3b82f6);
            color: white;
            border-right-color: white;
            transform: translateX(-10px) scale(1.05);
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.3);
            animation: bounce 0.6s ease-out;
        }

        .area-item.selected .area-name,
        .area-item.selected .area-info {
            color: white;
        }

        .area-name {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .area-info {
            font-size: 0.9rem;
            color: #64748b;
            display: flex;
            gap: 15px;
            margin-top: 8px;
        }

        .area-info span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ========== DETAILS PANEL ========== */
        .details-panel {
            background: linear-gradient(135deg, #f0f9ff 0%, #f5f3ff 100%);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid var(--secondary);
            animation: slideInRight 0.5s ease-out;
        }

        .details-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--secondary);
        }

        .details-header h3 {
            font-size: 1.4rem;
            color: var(--primary);
        }

        .details-header .badge {
            background: linear-gradient(135deg, var(--secondary), #3b82f6);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* ========== THREE BOXES GRID ========== */
        .three-boxes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-box {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-md);
            border-top: 4px solid var(--secondary);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            animation: fadeInUp 0.5s ease-out backwards;
        }

        .info-box:nth-child(1) {
            animation-delay: 0s;
            border-top-color: #dc2626;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
        }

        .info-box:nth-child(2) {
            animation-delay: 0.1s;
            border-top-color: #16a34a;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        }

        .info-box:nth-child(3) {
            animation-delay: 0.2s;
            border-top-color: #0891b2;
            background: linear-gradient(135deg, #f0f9ff 0%, #cffafe 100%);
        }

        .info-box:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .box-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-box:nth-child(1) .box-title {
            color: #dc2626;
        }

        .info-box:nth-child(2) .box-title {
            color: #16a34a;
        }

        .info-box:nth-child(3) .box-title {
            color: #0891b2;
        }

        .box-content {
            color: #334155;
            line-height: 1.8;
            margin-bottom: 15px;
            min-height: 100px;
            max-height: 150px;
            overflow-y: auto;
        }

        .box-content::-webkit-scrollbar {
            width: 6px;
        }

        .box-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .item-chip {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            animation: slideInLeft 0.4s ease-out backwards;
        }

        .item-chip:hover {
            transform: translateX(-5px);
            box-shadow: var(--shadow-md);
        }

        .item-chip .delete-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .item-chip .delete-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .add-item-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .add-item-input input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .add-item-input input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .add-item-input button {
            padding: 10px 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .add-item-input button:hover {
            background: var(--primary);
            transform: scale(1.05);
        }

        .empty-state {
            text-align: center;
            padding: 30px;
            color: #94a3b8;
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }

        /* ========== VISIT DATE ========== */
        .visit-section {
            margin-bottom: 30px;
        }

        .visit-label {
            display: block;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .visit-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .visit-input:hover,
        .visit-input:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
            outline: none;
        }

        /* ========== ACTION BUTTONS ========== */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            flex: 1;
            min-width: 150px;
        }

        /* ========== MODALS ========== */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeInDown 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: scaleIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .modal-header h3 {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .modal-close {
            background: #f1f5f9;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--primary);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--secondary);
            color: white;
            transform: rotate(90deg);
        }

        .form-group {
            margin-bottom: 25px;
            animation: fadeInUp 0.4s ease-out backwards;
        }

        .form-group:nth-child(1) { animation-delay: 0s; }
        .form-group:nth-child(2) { animation-delay: 0.1s; }
        .form-group:nth-child(3) { animation-delay: 0.2s; }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .modal-buttons .btn {
            flex: 1;
        }

        /* ========== PRINT SECTION ========== */
        .print-section {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow-lg);
            animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.3s backwards;
        }

        .print-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .print-preview {
            background: white;
            padding: 40px;
            border-radius: 15px;
            margin-top: 30px;
            display: none;
            box-shadow: var(--shadow-md);
            animation: fadeInUp 0.5s ease-out;
        }

        .print-preview.active {
            display: block;
        }

        .print-preview h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.4rem;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary);
        }

        .print-item {
            margin-bottom: 30px;
            padding-bottom: 30px;
            border-bottom: 1px solid #e2e8f0;
        }

        .print-item:last-child {
            border-bottom: none;
        }

        .print-item h4 {
            color: var(--secondary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .print-item p {
            color: #334155;
            line-height: 1.8;
            margin-bottom: 10px;
        }

        /* ========== PRESENTATION MODE ========== */
        .presentation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            z-index: 2000;
            display: none;
            overflow: hidden;
        }

        .presentation.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeInDown 0.5s ease-out;
        }

        .presentation-slide {
            background: white;
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            border-radius: 20px;
            padding: 60px;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .presentation-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 4px solid var(--secondary);
        }

        .presentation-header h2 {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 15px;
            animation: fadeInDown 0.6s ease-out 0.2s backwards;
        }

        .presentation-content {
            font-size: 1.2rem;
            line-height: 1.8;
            color: #334155;
        }

        .presentation-content .item {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
            border-right: 4px solid var(--secondary);
            animation: slideInLeft 0.5s ease-out backwards;
        }

        .presentation-content .item:nth-child(1) { animation-delay: 0.2s; }
        .presentation-content .item:nth-child(2) { animation-delay: 0.3s; }
        .presentation-content .item:nth-child(3) { animation-delay: 0.4s; }
        .presentation-content .item:nth-child(4) { animation-delay: 0.5s; }
        .presentation-content .item:nth-child(5) { animation-delay: 0.6s; }

        .presentation-controls {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 2001;
        }

        .presentation-controls button {
            padding: 15px 30px;
            background: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: var(--shadow-lg);
        }

        .presentation-controls button:hover {
            background: var(--secondary);
            color: white;
            transform: scale(1.1);
        }

        .presentation-controls .close-btn {
            background: var(--accent);
            color: white;
        }

        .presentation-controls .close-btn:hover {
            background: #b91c1c;
        }

        /* ========== RESPONSIVE DESIGN ========== */
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .three-boxes {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2rem;
            }

            .presentation-slide {
                padding: 40px 20px;
            }

            .presentation-header h2 {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 30px 15px;
                margin-bottom: 25px;
            }

            header h1 {
                font-size: 1.8rem;
            }

            header .subtitle {
                font-size: 1rem;
            }

            .controls {
                gap: 10px;
            }

            .btn {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .section {
                padding: 20px;
                border-radius: 15px;
            }

            .three-boxes {
                gap: 15px;
            }

            .info-box {
                padding: 15px;
            }

            .modal-content {
                padding: 25px;
                width: 95%;
            }

            .modal-header h3 {
                font-size: 1.3rem;
            }

            .presentation-slide {
                width: 95%;
                height: 90vh;
                padding: 30px 15px;
            }

            .presentation-header h2 {
                font-size: 1.5rem;
            }

            .presentation-content {
                font-size: 1rem;
            }

            @media print {
                body {
                    background: white;
                }

                .controls,
                .section:not(.print-section),
                .print-buttons {
                    display: none !important;
                }

                .print-preview {
                    display: block !important;
                    box-shadow: none;
                    padding: 0;
                }

                .print-preview h3 {
                    page-break-after: avoid;
                }

                .print-item {
                    page-break-inside: avoid;
                }
            }
        }

        /* ========== SOUND TOGGLE ========== */
        .sound-toggle {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--secondary), #7c3aed);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: var(--shadow-lg);
            z-index: 999;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeInUp 0.6s ease-out;
        }

        .sound-toggle:hover {
            transform: scale(1.15) rotate(15deg);
            box-shadow: var(--shadow-xl);
        }

        .sound-toggle:active {
            transform: scale(0.95);
        }

        .sound-toggle.muted {
            background: #94a3b8;
        }

        /* ========== NOTIFICATIONS ========== */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 24px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 1100;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            animation: fadeInDown 0.4s ease-out;
            border-left: 4px solid var(--secondary);
        }

        .notification.success {
            border-left-color: var(--success);
        }

        .notification.error {
            border-left-color: var(--accent);
        }

        .notification.info {
            border-left-color: var(--info);
        }
    </style>
</head>
<body>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()" title="ÿ™ÿ¥ÿ∫ŸäŸÑ/ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿµŸàÿ™">
        <i class="fas fa-volume-up"></i>
    </button>

    <div class="container">
        <!-- Header -->
        <header>
            <h1>üó∫Ô∏è ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ•ÿØÿßÿ±Ÿäÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖ</h1>
            <p class="subtitle">ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ŸàÿßŸÑŸÇÿ±Ÿâ ŸàÿßŸÑŸÖÿ¥ÿßŸÉŸÑ ŸàÿßŸÑÿÆÿ∑ÿ∑ ŸÖÿπ ÿπÿ±Ÿàÿ∂ ÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©</p>
            <div class="controls">
                <button class="btn btn-primary" onclick="addMainArea()">
                    <i class="fas fa-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ∑ŸÇÿ© ÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
                </button>
                <button class="btn btn-success" onclick="printAll()">
                    <i class="fas fa-print"></i> ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑŸÉŸÑ
                </button>
                <button class="btn btn-warning" onclick="startPresentation()">
                    <i class="fas fa-presentation-screen"></i> ÿπÿ±ÿ∂ PowerPoint
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="main-grid">
            <!-- Left Panel: Areas List -->
            <div class="section">
                <h2 class="section-title">
                    <i class="fas fa-list"></i> ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ŸàÿßŸÑŸÇÿ±Ÿâ ŸàÿßŸÑÿ™Ÿàÿßÿ®ÿπ
                </h2>
                <div class="areas-list" id="areasList">
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿßÿ∑ŸÇ ÿ®ÿπÿØ. ÿ£ÿ∂ŸÅ ŸÖŸÜÿ∑ŸÇÿ© ÿ¨ÿØŸäÿØÿ©!</p>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Details -->
            <div class="section">
                <div id="detailsContainer" style="display: none;">
                    <div class="details-header">
                        <h3 id="detailsTitle">ÿßÿÆÿ™ÿ± ŸÖŸÜÿ∑ŸÇÿ©</h3>
                        <div class="badge" id="detailsBadge">ŸÖŸÜÿ∑ŸÇÿ© ÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</div>
                    </div>

                    <!-- Three Boxes: Problems, Plans, Last Visit -->
                    <div class="three-boxes">
                        <!-- Box 1: Problems -->
                        <div class="info-box">
                            <div class="box-title">
                                <i class="fas fa-exclamation-triangle"></i> ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ
                            </div>
                            <div class="box-content" id="problemsBox">
                                <div class="empty-state">
                                    <i class="fas fa-check-circle"></i>
                                    <p style="font-size: 0.9rem;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ¥ÿßŸÉŸÑ</p>
                                </div>
                            </div>
                            <div class="add-item-input">
                                <input type="text" id="problemInput" placeholder="ÿ£ÿ∂ŸÅ ŸÖÿ¥ŸÉŸÑÿ© ÿ¨ÿØŸäÿØÿ©...">
                                <button onclick="addProblem()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Box 2: Life Plans -->
                        <div class="info-box">
                            <div class="box-title">
                                <i class="fas fa-project-diagram"></i> ÿÆÿ∑ÿ∑ ÿ≠Ÿäÿßÿ© ŸÉÿ±ŸäŸÖÿ©
                            </div>
                            <div class="box-content" id="plansBox">
                                <div class="empty-state">
                                    <i class="fas fa-lightbulb"></i>
                                    <p style="font-size: 0.9rem;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿÆÿ∑ÿ∑</p>
                                </div>
                            </div>
                            <div class="add-item-input">
                                <input type="text" id="planInput" placeholder="ÿ£ÿ∂ŸÅ ÿÆÿ∑ÿ© ÿ¨ÿØŸäÿØÿ©...">
                                <button onclick="addPlan()">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Box 3: Last Visit -->
                        <div class="info-box">
                            <div class="box-title">
                                <i class="fas fa-calendar-check"></i> ÿ¢ÿÆÿ± ÿ≤Ÿäÿßÿ±ÿ©
                            </div>
                            <div class="visit-section">
                                <input type="date" class="visit-input" id="lastVisitDate" onchange="updateLastVisit()">
                                <p id="visitInfo" style="margin-top: 15px; color: #64748b; text-align: center;"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button class="btn btn-success" onclick="printSelected()">
                            <i class="fas fa-print"></i> ÿ∑ÿ®ÿßÿπÿ© Ÿáÿ∞Ÿá ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©
                        </button>
                        <button class="btn btn-primary" onclick="presentSelected()">
                            <i class="fas fa-presentation-screen"></i> ÿπÿ±ÿ∂ Ÿáÿ∞Ÿá ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©
                        </button>
                        <button class="btn btn-danger" onclick="deleteSelected()">
                            <i class="fas fa-trash"></i> ÿ≠ÿ∞ŸÅ
                        </button>
                    </div>
                </div>

                <div id="emptyDetails" style="text-align: center; padding: 60px 20px;">
                    <i class="fas fa-hand-pointer" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 20px;"></i>
                    <p style="color: #94a3b8; font-size: 1.1rem;">ÿßÿÆÿ™ÿ± ŸÖŸÜÿ∑ŸÇÿ© ÿ£Ÿà ŸÇÿ±Ÿäÿ© ŸÖŸÜ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ŸÑÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</p>
                </div>
            </div>
        </div>

        <!-- Print Section -->
        <div class="print-section">
            <h2 class="section-title">
                <i class="fas fa-file-pdf"></i> ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ∑ÿ®ÿßÿπÿ©
            </h2>
            <div class="print-buttons">
                <button class="btn btn-primary" onclick="refreshPrint()">
                    <i class="fas fa-sync"></i> ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿπÿßŸäŸÜÿ©
                </button>
                <button class="btn btn-success" onclick="window.print()">
                    <i class="fas fa-print"></i> ÿ∑ÿ®ÿßÿπÿ© ÿßŸÑÿ¢ŸÜ
                </button>
            </div>
            <div class="print-preview" id="printPreview"></div>
        </div>
    </div>

    <!-- Presentation Mode -->
    <div class="presentation" id="presentation">
        <div class="presentation-slide" id="presentationSlide">
            <div class="presentation-header">
                <h2 id="presentationTitle">ÿπŸÜŸàÿßŸÜ ÿßŸÑÿ¥ÿ±Ÿäÿ≠ÿ©</h2>
            </div>
            <div class="presentation-content" id="presentationContent">
                <!-- Content will be inserted here -->
            </div>
        </div>
        <div class="presentation-controls">
            <button onclick="previousSlide()">
                <i class="fas fa-chevron-right"></i> ÿßŸÑÿ≥ÿßÿ®ŸÇ
            </button>
            <button onclick="nextSlide()">
                ÿßŸÑÿ™ÿßŸÑŸä <i class="fas fa-chevron-left"></i>
            </button>
            <button class="close-btn" onclick="closePresentation()">
                <i class="fas fa-times"></i> ÿ•ÿ∫ŸÑÿßŸÇ
            </button>
        </div>
    </div>

    <!-- Modal Add Main Area -->
    <div class="modal" id="modalAddArea">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ∑ŸÇÿ© ÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</h3>
                <button class="modal-close" onclick="closeModal('modalAddArea')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label class="form-label">ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</label>
                <input type="text" class="form-input" id="areaName" placeholder="ŸÖÿ´ÿßŸÑ: ŸÖÿ≠ÿßŸÅÿ∏ÿ© ÿßŸÑŸÅŸäŸàŸÖ">
            </div>
            <div class="form-group">
                <label class="form-label">ŸáŸÑ ÿ®Ÿáÿß ŸÇÿ±Ÿâÿü</label>
                <select class="form-input" id="hasVillages">
                    <option value="true">ŸÜÿπŸÖÿå ÿ®Ÿáÿß ŸÇÿ±Ÿâ</option>
                    <option value="false">ŸÑÿßÿå ÿ™Ÿàÿßÿ®ÿπ ŸÖÿ®ÿßÿ¥ÿ±ÿ©</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveMainArea()">
                    <i class="fas fa-check"></i> ÿ≠ŸÅÿ∏
                </button>
                <button class="btn btn-danger" onclick="closeModal('modalAddArea')">
                    <i class="fas fa-times"></i> ÿ•ŸÑÿ∫ÿßÿ°
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Add Village/Sub -->
    <div class="modal" id="modalAddVillage">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalVillageTitle">ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ±Ÿäÿ©</h3>
                <button class="modal-close" onclick="closeModal('modalAddVillage')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="form-group">
                <label class="form-label" id="modalVillageLabel">ÿßÿ≥ŸÖ ÿßŸÑŸÇÿ±Ÿäÿ©</label>
                <input type="text" class="form-input" id="villageName" placeholder="ÿ£ÿØÿÆŸÑ ÿßŸÑÿßÿ≥ŸÖ">
            </div>
            <div class="modal-buttons">
                <button class="btn btn-success" onclick="saveVillage()">
                    <i class="fas fa-check"></i> ÿ≠ŸÅÿ∏
                </button>
                <button class="btn btn-danger" onclick="closeModal('modalAddVillage')">
                    <i class="fas fa-times"></i> ÿ•ŸÑÿ∫ÿßÿ°
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== GLOBAL STATE ==========
        let appState = {
            areas: [],
            selectedItem: null,
            selectedType: null,
            soundEnabled: true,
            presentationSlides: [],
            currentSlide: 0
        };

        // ========== SOUND EFFECTS ==========
        function playSound(frequency, duration, type = 'sine') {
            if (!appState.soundEnabled) return;
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();

                osc.connect(gain);
                gain.connect(ctx.destination);

                osc.frequency.value = frequency;
                osc.type = type;
                gain.gain.setValueAtTime(0.3, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);

                osc.start(ctx.currentTime);
                osc.stop(ctx.currentTime + duration);
            } catch(e) {}
        }

        function toggleSound() {
            appState.soundEnabled = !appState.soundEnabled;
            const btn = document.getElementById('soundToggle');
            if (appState.soundEnabled) {
                btn.innerHTML = '<i class="fas fa-volume-up"></i>';
                btn.classList.remove('muted');
                playSound(880, 0.1);
            } else {
                btn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                btn.classList.add('muted');
            }
        }

        // ========== NOTIFICATIONS ==========
        function showNotification(message, type = 'info') {
            playSound(type === 'error' ? 300 : 600, 0.2);
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-circle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i> ${message}`;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        // ========== MODAL FUNCTIONS ==========
        function openModal(id) {
            document.getElementById(id).classList.add('active');
            playSound(500, 0.1);
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            playSound(600, 0.1);
        }

        // ========== MAIN AREA FUNCTIONS ==========
        function addMainArea() {
            openModal('modalAddArea');
            document.getElementById('areaName').value = '';
        }

        function saveMainArea() {
            const name = document.getElementById('areaName').value.trim();
            if (!name) {
                showNotification('ÿ£ÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©', 'error');
                return;
            }

            const hasVillages = document.getElementById('hasVillages').value === 'true';
            const newArea = {
                id: 'area_' + Date.now(),
                name: name,
                hasVillages: hasVillages,
                children: [],
                problems: [],
                plans: [],
                lastVisit: ''
            };

            appState.areas.push(newArea);
            closeModal('modalAddArea');
            renderAreas();
            showNotification(`ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© "${name}" ÿ®ŸÜÿ¨ÿßÿ≠!`, 'success');
            saveToFirebase();
        }

        // ========== RENDER FUNCTIONS ==========
        function renderAreas() {
            const container = document.getElementById('areasList');
            if (appState.areas.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿßÿ∑ŸÇ</p></div>';
                return;
            }

            container.innerHTML = '';
            appState.areas.forEach((area, index) => {
                const div = document.createElement('div');
                div.className = 'area-item';
                if (appState.selectedItem?.id === area.id) {
                    div.classList.add('selected');
                }

                div.innerHTML = `
                    <div class="area-name">
                        <i class="fas fa-map-marked-alt"></i> ${area.name}
                    </div>
                    <div class="area-info">
                        <span><i class="fas fa-folder"></i> ${area.children.length} ÿπŸÜÿµÿ±</span>
                        <span><i class="fas fa-exclamation-triangle"></i> ${area.problems.length} ŸÖÿ¥ŸÉŸÑÿ©</span>
                        <span><i class="fas fa-plus"></i> ${area.children.length + (area.hasVillages ? 1 : 0)}</span>
                    </div>
                `;

                div.onclick = () => selectItem(area, 'area');
                const addBtn = document.createElement('button');
                addBtn.className = 'btn btn-sm btn-success';
                addBtn.style.marginTop = '10px';
                addBtn.style.width = '100%';
                addBtn.innerHTML = '<i class="fas fa-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ' + (area.hasVillages ? 'ŸÇÿ±Ÿäÿ©' : 'ÿ™ÿßÿ®ÿπ');
                addBtn.onclick = (e) => {
                    e.stopPropagation();
                    appState.currentParent = area;
                    openModal('modalAddVillage');
                    document.getElementById('modalVillageTitle').textContent = area.hasVillages ? 'ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ±Ÿäÿ©' : 'ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿßÿ®ÿπ';
                };

                div.appendChild(addBtn);
                container.appendChild(div);

                // Render children
                if (area.children.length > 0) {
                    area.children.forEach((child, childIndex) => {
                        const childDiv = document.createElement('div');
                        childDiv.className = 'area-item';
                        childDiv.style.marginRight = '20px';
                        childDiv.style.marginTop = '10px';
                        if (appState.selectedItem?.id === child.id) {
                            childDiv.classList.add('selected');
                        }

                        const level = area.hasVillages ? 'üèòÔ∏è ŸÇÿ±Ÿäÿ©' : 'üè¢ ÿ™ÿßÿ®ÿπ';
                        childDiv.innerHTML = `
                            <div class="area-name">
                                <i class="fas fa-building"></i> ${level}: ${child.name}
                            </div>
                            <div class="area-info">
                                <span><i class="fas fa-exclamation-triangle"></i> ${child.problems?.length || 0}</span>
                                <span><i class="fas fa-list"></i> ${child.plans?.length || 0}</span>
                            </div>
                        `;

                        childDiv.onclick = () => selectItem(child, 'child', area);
                        container.appendChild(childDiv);
                    });
                }
            });
        }

        function saveVillage() {
            const name = document.getElementById('villageName').value.trim();
            if (!name) {
                showNotification('ÿ£ÿØÿÆŸÑ ÿßŸÑÿßÿ≥ŸÖ', 'error');
                return;
            }

            const newChild = {
                id: 'child_' + Date.now(),
                name: name,
                problems: [],
                plans: [],
                lastVisit: ''
            };

            appState.currentParent.children.push(newChild);
            closeModal('modalAddVillage');
            renderAreas();
            showNotification('ÿ™ŸÖ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
            saveToFirebase();
        }

        // ========== SELECTION ==========
        function selectItem(item, type, parent = null) {
            appState.selectedItem = item;
            appState.selectedType = type;
            appState.selectedParent = parent;
            playSound(700, 0.1);

            renderAreas();
            renderDetails();
        }

        function renderDetails() {
            const item = appState.selectedItem;
            if (!item) {
                document.getElementById('detailsContainer').style.display = 'none';
                document.getElementById('emptyDetails').style.display = 'block';
                return;
            }

            document.getElementById('detailsContainer').style.display = 'block';
            document.getElementById('emptyDetails').style.display = 'none';
            document.getElementById('detailsTitle').textContent = item.name;

            // Update badge
            const badge = document.getElementById('detailsBadge');
            if (appState.selectedType === 'area') {
                badge.textContent = appState.selectedItem.hasVillages ? 'ŸÖŸÜÿ∑ŸÇÿ© (ÿ®Ÿáÿß ŸÇÿ±Ÿâ)' : 'ŸÖŸÜÿ∑ŸÇÿ© (ÿ™Ÿàÿßÿ®ÿπ ŸÖÿ®ÿßÿ¥ÿ±ÿ©)';
            } else {
                badge.textContent = appState.selectedParent?.hasVillages ? 'ŸÇÿ±Ÿäÿ©' : 'ÿ™ÿßÿ®ÿπ';
            }

            // Render problems
            renderProblems();
            renderPlans();

            // Render last visit
            document.getElementById('lastVisitDate').value = item.lastVisit || '';
            updateVisitInfo();
        }

        function renderProblems() {
            const box = document.getElementById('problemsBox');
            const problems = appState.selectedItem.problems || [];

            if (problems.length === 0) {
                box.innerHTML = '<div class="empty-state"><i class="fas fa-check-circle"></i><p style="font-size: 0.9rem;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖÿ¥ÿßŸÉŸÑ</p></div>';
                return;
            }

            box.innerHTML = '<div class="items-list">' + 
                problems.map((problem, i) => `
                    <div class="item-chip">
                        <span>${problem}</span>
                        <button class="delete-btn" onclick="deleteProblem(${i})">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `).join('') + '</div>';
        }

        function renderPlans() {
            const box = document.getElementById('plansBox');
            const plans = appState.selectedItem.plans || [];

            if (plans.length === 0) {
                box.innerHTML = '<div class="empty-state"><i class="fas fa-lightbulb"></i><p style="font-size: 0.9rem;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿÆÿ∑ÿ∑</p></div>';
                return;
            }

            box.innerHTML = '<div class="items-list">' + 
                plans.map((plan, i) => `
                    <div class="item-chip">
                        <span>${plan}</span>
                        <button class="delete-btn" onclick="deletePlan(${i})">ÿ≠ÿ∞ŸÅ</button>
                    </div>
                `).join('') + '</div>';
        }

        function addProblem() {
            const input = document.getElementById('problemInput');
            const value = input.value.trim();
            if (!value) {
                showNotification('ÿ£ÿØÿÆŸÑ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©', 'error');
                return;
            }

            if (!appState.selectedItem.problems) {
                appState.selectedItem.problems = [];
            }
            appState.selectedItem.problems.push(value);
            input.value = '';
            renderProblems();
            playSound(600, 0.1);
            showNotification('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©!', 'success');
            saveToFirebase();
        }

        function deleteProblem(index) {
            appState.selectedItem.problems.splice(index, 1);
            renderProblems();
            playSound(300, 0.2);
            showNotification('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑŸÖÿ¥ŸÉŸÑÿ©', 'success');
            saveToFirebase();
        }

        function addPlan() {
            const input = document.getElementById('planInput');
            const value = input.value.trim();
            if (!value) {
                showNotification('ÿ£ÿØÿÆŸÑ ÿßŸÑÿÆÿ∑ÿ©', 'error');
                return;
            }

            if (!appState.selectedItem.plans) {
                appState.selectedItem.plans = [];
            }
            appState.selectedItem.plans.push(value);
            input.value = '';
            renderPlans();
            playSound(600, 0.1);
            showNotification('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿÆÿ∑ÿ©!', 'success');
            saveToFirebase();
        }

        function deletePlan(index) {
            appState.selectedItem.plans.splice(index, 1);
            renderPlans();
            playSound(300, 0.2);
            showNotification('ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿßŸÑÿÆÿ∑ÿ©', 'success');
            saveToFirebase();
        }

        function updateLastVisit() {
            appState.selectedItem.lastVisit = document.getElementById('lastVisitDate').value;
            updateVisitInfo();
            playSound(700, 0.1);
            saveToFirebase();
        }

        function updateVisitInfo() {
            const date = appState.selectedItem.lastVisit;
            if (date) {
                const d = new Date(date);
                document.getElementById('visitInfo').textContent = d.toLocaleDateString('ar-EG');
            } else {
                document.getElementById('visitInfo').textContent = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿ™ÿßÿ±ŸäÿÆ ÿ®ÿπÿØ';
            }
        }

        function deleteSelected() {
            if (confirm('ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ≠ÿ∞ŸÅ Ÿáÿ∞ÿß ÿßŸÑÿπŸÜÿµÿ±ÿü')) {
                if (appState.selectedType === 'area') {
                    appState.areas = appState.areas.filter(a => a.id !== appState.selectedItem.id);
                } else {
                    appState.selectedParent.children = appState.selectedParent.children.filter(c => c.id !== appState.selectedItem.id);
                }
                appState.selectedItem = null;
                renderAreas();
                document.getElementById('detailsContainer').style.display = 'none';
                document.getElementById('emptyDetails').style.display = 'block';
                showNotification('ÿ™ŸÖ ÿßŸÑÿ≠ÿ∞ŸÅ ÿ®ŸÜÿ¨ÿßÿ≠!', 'success');
                saveToFirebase();
            }
        }

        // ========== PRINT FUNCTIONS ==========
        function printAll() {
            playSound(500, 0.15);
            const content = appState.areas.map(area => `
                <div class="print-item">
                    <h4>${area.name}</h4>
                    <p><strong>ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ:</strong> ${area.problems?.join(', ') || 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ'}</p>
                    <p><strong>ÿßŸÑÿÆÿ∑ÿ∑:</strong> ${area.plans?.join(', ') || 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ'}</p>
                    <p><strong>ÿ¢ÿÆÿ± ÿ≤Ÿäÿßÿ±ÿ©:</strong> ${area.lastVisit || 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ'}</p>
                    ${area.children.length > 0 ? `
                        <div style="margin-right: 20px; margin-top: 15px;">
                            ${area.children.map(child => `
                                <div style="background: #f8fafc; padding: 10px; border-radius: 8px; margin-bottom: 10px;">
                                    <strong>‚Ä¢ ${child.name}</strong>
                                    <p style="margin: 5px 0; color: #64748b;">ŸÖÿ¥ÿßŸÉŸÑ: ${child.problems?.join(', ') || 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ'}</p>
                                    <p style="margin: 5px 0; color: #64748b;">ÿÆÿ∑ÿ∑: ${child.plans?.join(', ') || 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ'}</p>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');

            document.getElementById('printPreview').innerHTML = `<h3>ÿ∑ÿ®ÿßÿπÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸÜÿßÿ∑ŸÇ</h3>${content}`;
            document.getElementById('printPreview').classList.add('active');
        }

        function printSelected() {
            if (!appState.selectedItem) return;
            playSound(500, 0.15);

            let content = `<h3>${appState.selectedItem.name}</h3>`;
            content += `<p><strong>ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ:</strong> ${appState.selectedItem.problems?.join(', ') || 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ'}</p>`;
            content += `<p><strong>ÿßŸÑÿÆÿ∑ÿ∑:</strong> ${appState.selectedItem.plans?.join(', ') || 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ'}</p>`;
            content += `<p><strong>ÿ¢ÿÆÿ± ÿ≤Ÿäÿßÿ±ÿ©:</strong> ${appState.selectedItem.lastVisit || 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ'}</p>`;

            document.getElementById('printPreview').innerHTML = content;
            document.getElementById('printPreview').classList.add('active');
        }

        function refreshPrint() {
            document.getElementById('printPreview').classList.remove('active');
            setTimeout(() => printAll(), 300);
        }

        // ========== PRESENTATION FUNCTIONS ==========
        function startPresentation() {
            playSound(600, 0.2);
            generatePresentationSlides();
            appState.currentSlide = 0;
            showSlide(0);
            document.getElementById('presentation').classList.add('active');
        }

        function generatePresentationSlides() {
            appState.presentationSlides = [];
            appState.areas.forEach(area => {
                let html = '';
                if (area.problems.length > 0) {
                    html += '<div class="item"><strong>ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ:</strong><br>';
                    area.problems.forEach(p => html += `‚Ä¢ ${p}<br>`);
                    html += '</div>';
                }
                if (area.plans.length > 0) {
                    html += '<div class="item"><strong>ÿßŸÑÿÆÿ∑ÿ∑:</strong><br>';
                    area.plans.forEach(p => html += `‚Ä¢ ${p}<br>`);
                    html += '</div>';
                }
                if (area.lastVisit) {
                    html += `<div class="item"><strong>ÿ¢ÿÆÿ± ÿ≤Ÿäÿßÿ±ÿ©:</strong> ${area.lastVisit}</div>`;
                }
                if (area.children.length > 0) {
                    html += '<div class="item"><strong>ÿßŸÑÿ™Ÿàÿßÿ®ÿπ:</strong><br>';
                    area.children.forEach(child => html += `‚Ä¢ ${child.name}<br>`);
                    html += '</div>';
                }

                appState.presentationSlides.push({
                    title: area.name,
                    content: html || '<div class="item">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÅÿßÿµŸäŸÑ</div>'
                });
            });
        }

        function showSlide(index) {
            if (index < 0 || index >= appState.presentationSlides.length) return;
            appState.currentSlide = index;
            const slide = appState.presentationSlides[index];
            document.getElementById('presentationTitle').textContent = slide.title;
            document.getElementById('presentationContent').innerHTML = slide.content;
            playSound(500, 0.1);
        }

        function nextSlide() {
            showSlide(appState.currentSlide + 1);
        }

        function previousSlide() {
            showSlide(appState.currentSlide - 1);
        }

        function presentSelected() {
            if (!appState.selectedItem) return;
            playSound(600, 0.2);
            let html = '';
            if (appState.selectedItem.problems.length > 0) {
                html += '<div class="item"><strong>ÿßŸÑŸÖÿ¥ÿßŸÉŸÑ:</strong><br>';
                appState.selectedItem.problems.forEach(p => html += `‚Ä¢ ${p}<br>`);
                html += '</div>';
            }
            if (appState.selectedItem.plans.length > 0) {
                html += '<div class="item"><strong>ÿßŸÑÿÆÿ∑ÿ∑:</strong><br>';
                appState.selectedItem.plans.forEach(p => html += `‚Ä¢ ${p}<br>`);
                html += '</div>';
            }
            if (appState.selectedItem.lastVisit) {
                html += `<div class="item"><strong>ÿ¢ÿÆÿ± ÿ≤Ÿäÿßÿ±ÿ©:</strong> ${appState.selectedItem.lastVisit}</div>`;
            }

            document.getElementById('presentationTitle').textContent = appState.selectedItem.name;
            document.getElementById('presentationContent').innerHTML = html || '<div class="item">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÅÿßÿµŸäŸÑ</div>';
            document.getElementById('presentation').classList.add('active');
        }

        function closePresentation() {
            document.getElementById('presentation').classList.remove('active');
            playSound(400, 0.1);
        }

        // ========== FIREBASE ==========
        async function saveToFirebase() {
            try {
                const areaRef = window.firebaseRef(window.firebaseDB, 'areas');
                await window.firebaseSet(areaRef, appState.areas);
            } catch(e) {
                console.log('Firebase error:', e.message);
            }
        }

        // ========== INIT ==========
        document.addEventListener('DOMContentLoaded', () => {
            renderAreas();
            showNotification('ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ŸÜÿ∏ÿßŸÖ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ•ÿØÿßÿ±Ÿäÿ©!', 'info');
        });
    </script>

</body>
</html>
